<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Carregando...</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ifrn-green': {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#2f6b48',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        'ifrn-red': {
                            500: '#e63946',
                            600: '#d62828',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        .code-block {
            background: #1f2937;
            color: #d1d5db;
            padding: 1.5rem;
            border-radius: 1rem;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }

        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .checkbox-item {
            transition: all 0.2s;
        }

        .checkbox-item:hover {
            background: #f0fdf4;
            border-color: #2f6b48;
        }

        .checkbox-item input:checked+label {
            text-decoration: line-through;
            opacity: 0.6;
        }

        html {
            scroll-behavior: smooth;
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        .error-state {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
        }
    </style>
</head>

<body class="bg-gray-50">

    <!-- Loading State -->
    <div id="loading-state" class="min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div
                class="w-16 h-16 border-4 border-ifrn-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4">
            </div>
            <p class="text-xl text-gray-600">Carregando conte√∫do da aula...</p>
            <p class="text-sm text-gray-500 mt-2" id="loading-week"></p>
        </div>
    </div>

    <!-- Error State -->
    <div id="error-state" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="error-state max-w-2xl">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Erro ao carregar conte√∫do</h2>
            <p class="text-gray-600 mb-4" id="error-message"></p>
            <div class="flex gap-4 justify-center flex-wrap">
                <button onclick="location.reload()"
                    class="px-6 py-3 bg-ifrn-green-600 text-white rounded-xl font-bold hover:bg-ifrn-green-700">
                    Tentar novamente
                </button>
                <a href="aula.html?aula=32"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300">
                    Ir para Semana 32
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="hidden">

        <!-- Hero -->
        <section
            class="relative bg-gradient-to-br from-ifrn-green-800 via-ifrn-green-700 to-ifrn-green-600 text-white py-20 px-4 sm:px-6 lg:px-8">
            <div class="max-w-5xl mx-auto">
                <div class="flex items-center gap-2 text-sm text-ifrn-green-100 mb-6" id="breadcrumb"></div>
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-ifrn-green-500 rounded-full mb-6" id="badge">
                </div>
                <h1 class="font-bold text-4xl md:text-5xl lg:text-6xl mb-6 leading-tight" id="headline"></h1>
                <p class="text-xl md:text-2xl text-ifrn-green-50 mb-8 leading-relaxed max-w-3xl" id="subheadline"></p>
                <div class="flex flex-wrap gap-4" id="ctas"></div>
                <div class="grid md:grid-cols-3 gap-4 mt-12" id="info-cards"></div>
            </div>
        </section>

        <!-- Inten√ß√£o de Aprendizagem -->
        <section class="py-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-r from-ifrn-green-700 to-ifrn-green-600">
            <div class="max-w-5xl mx-auto">
                <div class="bg-white bg-opacity-10 backdrop-blur rounded-2xl p-8 border border-white border-opacity-20">
                    <h2 class="font-bold text-2xl text-white mb-4 flex items-center gap-3">
                        <span class="text-3xl">üéØ</span>
                        Inten√ß√£o de Aprendizagem
                    </h2>
                    <p class="text-xl text-white leading-relaxed" id="learning-intention"></p>
                </div>
            </div>
        </section>

        <!-- Crit√©rios de Sucesso -->
        <section class="py-16 px-4 sm:px-6 lg:px-8 bg-gray-100">
            <div class="max-w-5xl mx-auto">
                <h2 class="font-bold text-4xl text-gray-900 mb-4">‚úÖ Crit√©rios de Sucesso</h2>
                <p class="text-lg text-gray-600 mb-8">Marque conforme voc√™ for conseguindo:</p>
                <div class="grid md:grid-cols-2 gap-4" id="success-criteria"></div>
            </div>
        </section>

        <!-- Retomada -->
        <section class="py-16 px-4 sm:px-6 lg:px-8 bg-white" id="retomada-section"></section>

        <!-- Conte√∫do Principal -->
        <div id="main-sections"></div>

        <!-- Lista da Semana -->
        <section class="py-16 px-4 sm:px-6 lg:px-8 bg-gradient-to-br from-red-50 to-orange-50" id="lista">
            <div class="max-w-5xl mx-auto">
                <div class="bg-gradient-to-r from-ifrn-red-600 to-ifrn-red-500 rounded-3xl p-8 md:p-12 text-white mb-8 shadow-2xl"
                    id="lista-header"></div>
                <div class="space-y-6" id="lista-items"></div>
                <div class="mt-8 bg-yellow-50 border-l-4 border-yellow-500 p-6 rounded-xl" id="lista-alert"></div>
            </div>
        </section>

        <!-- Autoavalia√ß√£o -->
        <section class="py-16 px-4 sm:px-6 lg:px-8 bg-white">
            <div class="max-w-5xl mx-auto">
                <h2 class="font-bold text-4xl text-gray-900 mb-8">üéØ Mini-Autoavalia√ß√£o</h2>
                <p class="text-xl text-gray-700 mb-8">Seja honesto. Como voc√™ se sente com os conte√∫dos desta semana?
                </p>
                <div class="space-y-4" id="autoavaliacao-options"></div>
            </div>
        </section>

        <!-- Fechamento -->
        <section class="py-16 px-4 sm:px-6 lg:px-8 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white">
            <div class="max-w-5xl mx-auto text-center" id="fechamento"></div>
        </section>

    </div>

    <script type="module">
        // CONFIGURA√á√ÉO
        const DATA_PATH = 'data';
        const CACHE_VERSION = '2024-11-24';

        function getAulaFromURL() {
            const params = new URLSearchParams(window.location.search);
            const aula = params.get('aula');

            if (!aula) {
                window.location.href = 'aula.html?aula=32';
                return null;
            }

            const aulaNum = parseInt(aula);
            if (isNaN(aulaNum) || aulaNum < 31 || aulaNum > 40) {
                throw new Error(`N√∫mero de aula inv√°lido: ${aula}. Use valores entre 31 e 40.`);
            }

            return aulaNum;
        }

        let currentWeek;

        try {
            currentWeek = getAulaFromURL();
            if (!currentWeek) return;
            document.getElementById('loading-week').textContent = `Semana ${currentWeek}`;
        } catch (error) {
            showError(error.message);
            throw error;
        }

        // CARREGAR JSON LOCAL
        async function loadLessonData() {
            try {
                showLoading();

                const url = `${DATA_PATH}/semana${currentWeek}.json?v=${CACHE_VERSION}`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`Arquivo semana${currentWeek}.json n√£o encontrado na pasta ${DATA_PATH}/`);
                }

                const data = await response.json();

                if (!data.meta || !data.hero || !data.sections) {
                    throw new Error('Estrutura do JSON inv√°lida.');
                }

                renderPage(data);
                initInteractivity();
                showContent();

            } catch (error) {
                console.error('Erro:', error);
                showError(error.message);
            }
        }

        // RENDERIZA√á√ÉO
        function renderPage(data) {
            document.getElementById('page-title').textContent = data.meta.title;

            document.getElementById('breadcrumb').innerHTML = `
                <a href="${data.meta.breadcrumb.disciplina.url}" class="hover:text-white transition">${data.meta.breadcrumb.disciplina.text}</a>
                <span>/</span>
                <a href="${data.meta.breadcrumb.bimestre.url}" class="hover:text-white transition">${data.meta.breadcrumb.bimestre.text}</a>
                <span>/</span>
                <span class="text-white font-semibold">${data.meta.breadcrumb.semana}</span>
            `;

            document.getElementById('badge').innerHTML = `
                <span class="text-xl">${data.hero.badge.icon}</span>
                <span class="font-semibold text-sm">${data.hero.badge.text}</span>
            `;

            document.getElementById('headline').textContent = data.hero.headline;
            document.getElementById('subheadline').textContent = data.hero.subheadline;

            document.getElementById('ctas').innerHTML = data.hero.ctas.map(cta => `
                <a href="${cta.href}" class="px-8 py-4 ${cta.style} font-bold rounded-xl transition shadow-lg">
                    ${cta.text}
                </a>
            `).join('') + `
                <a href="aula-exercicios.html?aula=${currentWeek}" class="px-8 py-4 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl transition shadow-lg">
                    Ver exerc√≠cios ‚Üí
                </a>
            `;

            document.getElementById('info-cards').innerHTML = data.hero.infoCards.map(card => `
                <div class="bg-white bg-opacity-10 backdrop-blur rounded-xl p-4 border border-white border-opacity-20">
                    <p class="text-ifrn-green-100 text-sm mb-1">${card.label}</p>
                    <p class="font-bold text-lg">${card.value}</p>
                </div>
            `).join('');

            document.getElementById('learning-intention').textContent = data.learningIntention;

            document.getElementById('success-criteria').innerHTML = data.successCriteria.map((c, i) => `
                <div class="checkbox-item bg-white rounded-xl p-5 border-2 border-gray-200 flex items-start gap-4 cursor-pointer">
                    <input type="checkbox" id="sc${i + 1}" class="w-6 h-6 mt-1 cursor-pointer">
                    <label for="sc${i + 1}" class="flex-1 cursor-pointer text-gray-800">${c}</label>
                </div>
            `).join('');

            if (data.retomada) {
                document.getElementById('retomada-section').innerHTML = `
                    <div class="max-w-5xl mx-auto">
                        <div class="bg-gray-50 rounded-2xl p-8 border-l-4 border-ifrn-green-500">
                            <h3 class="font-bold text-2xl text-gray-900 mb-4 flex items-center gap-2">
                                <span>${data.retomada.icon}</span>
                                ${data.retomada.title}
                            </h3>
                            <p class="text-lg text-gray-700 leading-relaxed">${data.retomada.content}</p>
                        </div>
                    </div>
                `;
            }

            document.getElementById('main-sections').innerHTML = data.sections.map(renderSection).join('');
            renderLista(data.lista);
            renderAutoavaliacao(data.autoavaliacao);
            renderFechamento(data.fechamento);
        }

        function renderSection(section) {
            const bgClass = section.background || 'bg-white';
            let content = `<section class="py-16 px-4 sm:px-6 lg:px-8 ${bgClass}" ${section.id ? `id="${section.id}"` : ''}><div class="max-w-5xl mx-auto"><h2 class="font-bold text-4xl text-gray-900 mb-8">${section.title}</h2>`;
            if (section.intro) content += `<p class="text-xl text-gray-700 mb-8 leading-relaxed">${section.intro}</p>`;
            if (section.content) content += renderSectionContent(section.content);
            content += '</div></section>';
            return content;
        }

        function renderSectionContent(content) {
            return content.map(block => {
                if (block.type === 'grid') {
                    return `<div class="grid ${block.columns} gap-6 mb-8">${block.items.map(item =>
                        `<div class="${item.class}">${item.content || ''}</div>`
                    ).join('')}</div>`;
                } else if (block.type === 'code-example') {
                    return `<div class="bg-white rounded-2xl p-8 shadow-lg border-2 border-gray-200 mb-8">
                        ${block.title ? `<h3 class="font-bold text-xl text-gray-900 mb-4">${block.title}</h3>` : ''}
                        <div class="code-block">${block.code}</div>
                        ${block.console ? `<div class="bg-gray-900 text-white p-6 rounded-2xl mt-6">
                            <p class="font-bold text-lg mb-3">üì∫ Resultado no Console:</p>
                            <div class="font-mono text-sm space-y-1">
                                ${block.console.map(line => `<p><span class="text-gray-400">&gt;</span> ${line}</p>`).join('')}
                            </div>
                        </div>` : ''}
                    </div>`;
                } else if (block.type === 'alert') {
                    return `<div class="mt-8 ${block.bgClass} border-l-4 ${block.borderClass} p-6 rounded-xl">
                        <p class="font-bold ${block.titleClass} mb-2">${block.icon} ${block.title}</p>
                        <p class="${block.contentClass}">${block.content}</p>
                    </div>`;
                }
                return '';
            }).join('');
        }

        function renderLista(lista) {
            document.getElementById('lista-header').innerHTML = `
                <h2 class="font-bold text-4xl mb-4">${lista.title}</h2>
                <p class="text-xl opacity-95 mb-2">${lista.entrega}</p>
                <p class="text-lg opacity-90">${lista.intro}</p>
            `;

            document.getElementById('lista-items').innerHTML = lista.items.map(item => `
                <div class="bg-white rounded-2xl p-8 shadow-xl border-2 border-red-200">
                    <div class="flex items-start gap-4 mb-6">
                        <div class="w-14 h-14 bg-red-600 text-white rounded-xl flex items-center justify-center text-2xl font-bold flex-shrink-0">
                            ${item.number}
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-2xl text-gray-900 mb-3">${item.title}</h3>
                            <p class="text-lg text-gray-700 mb-4">${item.intro}</p>
                            ${item.tasks ? `<ul class="space-y-2 text-gray-700">
                                ${item.tasks.map(task => `<li class="flex items-start gap-2">
                                    <span class="text-ifrn-green-600">‚Ä¢</span><span>${task}</span>
                                </li>`).join('')}
                            </ul>` : ''}
                            ${item.questions ? `<ul class="space-y-3 text-gray-700">
                                ${item.questions.map((q, idx) => `<li class="flex items-start gap-2">
                                    <span class="text-ifrn-green-600">${idx + 1}.</span><span>${q}</span>
                                </li>`).join('')}
                            </ul>` : ''}
                        </div>
                    </div>
                    ${item.note ? `<div class="bg-gray-50 rounded-xl p-4 border-l-4 border-gray-400">
                        <p class="text-sm text-gray-700">${item.note}</p>
                    </div>` : ''}
                </div>
            `).join('');

            document.getElementById('lista-alert').innerHTML = `
                <p class="font-bold text-yellow-900 mb-2">${lista.alert.icon} ${lista.alert.title}</p>
                <p class="text-yellow-800">${lista.alert.content}</p>
            `;
        }

        function renderAutoavaliacao(autoavaliacao) {
            document.getElementById('autoavaliacao-options').innerHTML = autoavaliacao.options.map(option => `
                <label class="flex items-start gap-4 p-6 bg-gray-100 hover:bg-gray-200 rounded-xl cursor-pointer border-2 border-gray-200 transition">
                    <input type="radio" name="autoavaliacao" value="${option.value}" class="w-6 h-6 mt-1">
                    <div>
                        <p class="font-bold text-gray-900 mb-1">${option.value} ‚Äî ${option.label}</p>
                        <p class="text-gray-600">${option.description}</p>
                    </div>
                </label>
            `).join('');
        }

        function renderFechamento(fechamento) {
            document.getElementById('fechamento').innerHTML = `
                <h2 class="font-bold text-4xl mb-6">${fechamento.title}</h2>
                <div class="max-w-3xl mx-auto space-y-6">
                    <p class="text-xl leading-relaxed opacity-95">${fechamento.intro}</p>
                    <div class="bg-white bg-opacity-10 backdrop-blur rounded-2xl p-8 border border-white border-opacity-20">
                        <p class="text-lg leading-relaxed opacity-90">${fechamento.nextWeek}</p>
                    </div>
                    ${fechamento.quote ? `<div class="bg-ifrn-green-600 bg-opacity-20 backdrop-blur rounded-2xl p-6 border-l-4 border-ifrn-green-400">
                        <p class="text-lg italic">"${fechamento.quote}"</p>
                    </div>` : ''}
                    <p class="text-sm opacity-75 mt-8">${fechamento.footer}</p>
                </div>
            `;
        }

        // INTERATIVIDADE
        function initInteractivity() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });

            const weekKey = `semana${currentWeek}`;
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                const saved = localStorage.getItem(`${weekKey}_${checkbox.id}`);
                if (saved === 'true') checkbox.checked = true;
                checkbox.addEventListener('change', function () {
                    localStorage.setItem(`${weekKey}_${this.id}`, this.checked);
                });
            });

            const radioButtons = document.querySelectorAll('input[name="autoavaliacao"]');
            const savedRating = localStorage.getItem(`${weekKey}_autoavaliacao`);
            if (savedRating) {
                const radioToCheck = document.querySelector(`input[name="autoavaliacao"][value="${savedRating}"]`);
                if (radioToCheck) radioToCheck.checked = true;
            }
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function () {
                    localStorage.setItem(`${weekKey}_autoavaliacao`, this.value);
                });
            });
        }

        // ESTADOS UI
        function showLoading() {
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('error-state').classList.add('hidden');
            document.getElementById('main-content').classList.add('hidden');
        }

        function showContent() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('error-state').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        }

        function showError(message) {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('error-state').classList.remove('hidden');
            document.getElementById('error-message').textContent = message;
        }

        loadLessonData();
    </script>

</body>

</html>